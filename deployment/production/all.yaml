apiVersion: v1
kind: ConfigMap
metadata:
  name: sub-backend-env
  namespace: sub-back
data:

  CORS_ALLOWED_ORIGIN: '*'
  FAUCET_DRIP_AMOUNT: "0.05"
  FAUCET_MAX_AMOUNT_TOP_UP: "0.025"
  FAUCET_MNEMONIC: ""
  IPFS_MAX_FILE_SIZE_BYTES: "2097152"
  
  KUSAMA_NODE_URL: "wss://kusama-rpc.polkadot.io"
  SUBSTRATE_URL: "wss://arch.subsocial.network" 
  RECAPTCHA_KEY: ""

  LOG_LEVEL: info
  MAX_RESULTS_LIMIT: "20"
  OFFCHAIN_REQ_TIMEOUT_SECS: "5"
  OFFCHAIN_SERVER_PORT: "3001"
  OFFCHAIN_TELEGRAM_WS_PORT: "3020"
  OFFCHAIN_WS_PORT: "3011"
  PG_SSL: "true"
  PGPORT: "25060"
  PG_MAX_POOL_SIZE: "100"
  SUBSTRATE_EVENT_METHODS: SpaceCreated,SpaceUpdated,SpaceFollowed,SpaceUnfollowed,AccountFollowed,AccountUnfollowed,PostCreated,PostUpdated,PostShared,CommentCreated,CommentUpdated,PostReactionCreated,CommentReactionCreated,ProfileCreated
  SUBSTRATE_EVENT_SECTIONS: permissions,posts,profileFollows,profiles,reactions,scores,spaceFollows,spaceOwnership,spaces,utils
  TEST_MODE: "false"

---

apiVersion: batch/v1
kind: Job
metadata:
  name: sub-back-db-migrations
  namespace: sub-back
spec:
  backoffLimit: 10
  activeDeadlineSeconds: 240
  template:
    spec:
      containers:
      - name: sub-back-db-migrations
        image: <IMAGE>
        env:
        envFrom:
        - configMapRef:
            name: sub-backend-env
        command: ["yarn", "init-postgres"]
      restartPolicy: OnFailure
